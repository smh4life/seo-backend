<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SEO Metadata Generator</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #2c2f36;
        color: #f0f0f0;
        padding: 20px;
        min-height: 100vh;
        display: flex;
        justify-content: center;
    }
    .container { max-width: 900px; width: 100%; }
    h2, h3 { color: #ffffff; font-weight: bold; }
    .card { background-color: #1e1e1e; color: #f0f0f0; padding: 20px; margin-bottom: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
    input, textarea, button { font-size: 16px; padding: 10px; width: 100%; margin-bottom: 10px; border-radius: 5px; border: 1px solid #333; box-sizing: border-box; background-color: #2a2a2a; color: #f0f0f0; }
    button.generateBtn { background: #007bff; color: white; font-weight: bold; border: none; cursor: pointer; transition: 0.2s; }
    button.generateBtn:hover { background: #0056b3; }
    .copyBtn { margin-top: 6px; padding: 6px 12px; font-size: 14px; background: #28a745; border-radius: 5px; cursor: pointer; transition: 0.2s; display: inline-block; }
    .copyBtn.copied { background: #1f7e34; color: #fff; }
    .pixel-inputs { display: flex; gap: 10px; margin-bottom: 12px; }
    .pixel-label { font-size: 14px; color: #ccc; margin-bottom: 4px; }
    .result-field { margin-top: 10px; padding: 10px; background-color: #111; border-radius: 5px; font-weight: bold; white-space: pre-wrap; color: #f0f0f0; }
</style>
</head>
<body>
<div class="container">
<h2>SEO Metadata Generator</h2>

<!-- SINGLE TOPIC GENERATOR -->

<div class="card">
    <h3>Single Topic Generator</h3>
    <input id="topic" placeholder="Topic" />
    <input id="descriptionInput" placeholder="Description" />
    <div class="pixel-inputs">
        <div><div class="pixel-label">Title</div><input id="singleTitleLimit" type="number" value="580"></div>
        <div><div class="pixel-label">Description</div><input id="singleDescLimit" type="number" value="990"></div>
    </div>
    <button class="generateBtn" onclick="generate()">Generate</button>
    <div id="loadingSingle" style="display:none; color:#007bff; font-weight:bold;">Generating...</div>
    <div id="singleResult" class="card" style="display:none;"></div>
</div>

<!-- BATCH GENERATOR -->

<div class="card">
    <h3>Batch Generate Topics</h3>
    <textarea id="topics" placeholder="Enter topics, one per line..." rows="6"></textarea>
    <div class="pixel-inputs">
        <div><div class="pixel-label">Title</div><input id="batchTitleLimit" type="number" value="580"></div>
        <div><div class="pixel-label">Description</div><input id="batchDescLimit" type="number" value="990"></div>
    </div>
    <button class="generateBtn" onclick="generateAll()">Generate All</button>
    <button class="generateBtn" onclick="downloadCSV()">Download CSV</button>
    <div id="loadingBatch" style="display:none; color:#007bff; font-weight:bold;">Generating...</div>
    <div id="allResults"></div>
</div>
</div>

<script>
const API_URL = '/generate';

// Copy text helper
function copyText(button, id) {
    const textEl = document.getElementById(id);
    if (!textEl) return;
    const textToCopy = textEl.innerText || textEl.textContent || '';
    navigator.clipboard.writeText(textToCopy.trim()).then(() => {
        button.classList.add('copied');
        setTimeout(() => button.classList.remove('copied'), 1000);
    });
}

// Single topic generate
async function generate() {
    const topic = document.getElementById('topic').value.trim();
    const descInput = document.getElementById('descriptionInput').value.trim();
    const descLimit = parseInt(document.getElementById('singleDescLimit').value) || 990;

    if (!topic) return alert('Enter a topic');

    document.getElementById('loadingSingle').style.display = 'block';
    document.getElementById('singleResult').style.display = 'none';

    try {
        const res = await fetch(API_URL, {
            method: 'POST',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify({topic, maxLength: descLimit})
        });
        const data = await res.json();
        document.getElementById('loadingSingle').style.display = 'none';

        const container = document.getElementById('singleResult');
        container.style.display = 'block';
        container.innerHTML = `
            <div class="result-field" id="singleTitle">${data.title}</div>
            <button class="copyBtn" onclick="copyText(this, 'singleTitle')">Copy Title</button>

            <div class="result-field" id="singleDescription">${data.description}</div>
            <button class="copyBtn" onclick="copyText(this, 'singleDescription')">Copy Description</button>

            <div class="result-field" id="singleKeywords">${data.keywords}</div>
            <button class="copyBtn" onclick="copyText(this, 'singleKeywords')">Copy Keywords</button>
        `;
    } catch(e) {
        document.getElementById('loadingSingle').style.display = 'none';
        alert('Error generating SEO data');
        console.error(e);
    }
}

// Batch generate
async function generateAll() {
    const topics = document.getElementById('topics').value.trim().split('\n').filter(t=>t);
    const descLimit = parseInt(document.getElementById('batchDescLimit').value) || 990;

    if (!topics.length) return alert('Enter topics');

    document.getElementById('loadingBatch').style.display = 'block';
    const resultsDiv = document.getElementById('allResults');
    resultsDiv.innerHTML = '';
    const allResults = [];

    for (let topic of topics) {
        try {
            const res = await fetch(API_URL, {
                method:'POST',
                headers:{'Content-Type':'application/json'},
                body: JSON.stringify({topic, maxLength: descLimit})
            });
            const data = await res.json();

            const container = document.createElement('div');
            container.className = 'card result-field';
            container.innerHTML = `
                <strong>${topic}</strong><br>
                Title: ${data.title} <button class="copyBtn" onclick="navigator.clipboard.writeText('${data.title}')">Copy</button><br>
                Description: ${data.description} <button class="copyBtn" onclick="navigator.clipboard.writeText('${data.description}')">Copy</button><br>
                Keywords: ${data.keywords} <button class="copyBtn" onclick="navigator.clipboard.writeText('${data.keywords}')">Copy</button>
            `;
            resultsDiv.appendChild(container);
            allResults.push({topic, ...data});
        } catch(e) {
            console.error(e);
        }
    }

    document.getElementById('loadingBatch').style.display = 'none';
    window.batchResults = allResults; // store for CSV
}

// Download CSV
function downloadCSV() {
    if (!window.batchResults || !window.batchResults.length) return alert('No batch results');

    const headers = ['Topic','Title','Description','Keywords'];
    const rows = window.batchResults.map(r => [r.topic,r.title,r.description,r.keywords]);
    let csv = [headers.join(','), ...rows.map(r=>r.map(f=>`"${f.replace(/"/g,'""')}"`).join(','))].join('\n');

    const blob = new Blob([csv], {type:'text/csv'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'seo_batch.csv';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
}
</script>

</body>
</html>
