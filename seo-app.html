<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SEO Metadata Generator</title>
<style>
body { font-family: Arial, sans-serif; background-color: #2c2f36; color: #f0f0f0; padding: 20px; min-height: 100vh; display:flex; justify-content:center; }
.container { max-width: 900px; width:100%; }
h2,h3 { color: #fff; font-weight:bold; }
.card { background-color: #1e1e1e; color:#f0f0f0; padding:20px; margin-bottom:20px; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,0.5); }
input, textarea, button { font-size:16px; padding:10px; width:100%; margin-bottom:10px; border-radius:5px; border:1px solid #333; box-sizing:border-box; background-color:#2a2a2a; color:#f0f0f0; }
button.generateBtn { background:#007bff; color:white; font-weight:bold; border:none; cursor:pointer; transition:0.2s; }
button.generateBtn:hover { background:#0056b3; }
.copyBtn { margin-top:6px; padding:6px 12px; font-size:14px; background:#28a745; border-radius:5px; cursor:pointer; transition:0.2s; display:inline-block; }
.copyBtn.copied { background:#1f7e34; color:#fff; }

.pixel-inputs { display:flex; gap:10px; margin-bottom:12px; }
.pixel-label { font-size:14px; color:#ccc; margin-bottom:4px; }
.result-container { display:flex; justify-content:space-between; align-items:center; margin-top:10px; }
.result-field { flex:1; padding:10px; background-color:#111; border-radius:5px; font-weight:bold; white-space:pre-wrap; color:#f0f0f0; margin-right:10px; min-width:0; transition:border 0.2s, box-shadow 0.2s; }
.result-field.over-limit { border:2px solid red; box-shadow:0 0 8px rgba(255,0,0,0.5); }
.pixel-counter { font-size:12px; min-width:40px; text-align:right; color:#ccc; }

/* Google snippet styles */
.snippet { background-color:#1c1c1c; padding:10px; border-radius:5px; margin-top:6px; display:none; color:#e8e8e8; font-size:14px; line-height:1.4; }
.snippet-title { color:#1a73e8; font-weight:normal; font-size:16px; }
.snippet-url { color:#006621; font-size:12px; }
.snippet-description { color:#e8e8e8; }

@media(max-width:600px){ .result-container{flex-direction:column;} .pixel-counter{text-align:left; margin-top:4px;} }
</style>
</head>
<body>
<div class="container">
<h2>SEO Metadata Generator</h2>

<div class="card">
<h3>Single Topic Generator</h3>
<input id="topic" placeholder="Topic" />
<input id="descriptionInput" placeholder="Description" />
<div class="pixel-inputs">
    <div><div class="pixel-label">Title</div><input id="singleTitleLimit" type="number" value="580"></div>
    <div><div class="pixel-label">Description</div><input id="singleDescLimit" type="number" value="990"></div>
</div>
<button class="generateBtn" onclick="generate()">Generate</button>
<button class="generateBtn" onclick="resetSingle()">Reset Single</button>
<div id="loadingSingle" style="display:none; color:#007bff; font-weight:bold;">Generating...</div>
<div id="singleResult" class="card" style="display:none;"></div>
</div>

<div class="card">
<h3>Batch Topic Generator</h3>
<textarea id="topics" placeholder="Enter topics, one per line..." rows="6"></textarea>
<div class="pixel-inputs">
    <div><div class="pixel-label">Title</div><input id="batchTitleLimit" type="number" value="580"></div>
    <div><div class="pixel-label">Description</div><input id="batchDescLimit" type="number" value="990"></div>
</div>
<button class="generateBtn" onclick="generateAll()">Generate All</button>
<button class="generateBtn" onclick="downloadCSV()">Download CSV</button>
<button class="generateBtn" onclick="resetBatch()">Reset Batch</button>
<div id="loadingBatch" style="display:none; color:#007bff; font-weight:bold;">Generating...</div>
<div id="allResults"></div>
</div>
</div>

<script>
const API_URL = "http://localhost:3000/generate";

// Copy helper
function copyText(button, id){
    const textEl = document.getElementById(id);
    if(!textEl) return;
    const original = button.innerText;
    navigator.clipboard.writeText((textEl.innerText||"").trim())
        .then(()=>{ button.innerText="Copied!"; button.classList.add("copied");
            setTimeout(()=>{button.innerText=original; button.classList.remove("copied");},1000);
        });
}

// Pixel counters
function getTextPixelWidth(text,font="16px Arial"){ const canvas=document.createElement("canvas"); const ctx=canvas.getContext("2d"); ctx.font=font; return ctx.measureText(text).width; }
function updatePixelCounter(el,limit){ const counter=el.parentNode.querySelector(".pixel-counter"); const px=Math.round(getTextPixelWidth(el.innerText||"")); counter.textContent=px+"px"; if(px>limit){ counter.style.color="red"; el.classList.add("over-limit"); } else { counter.style.color="#ccc"; el.classList.remove("over-limit"); } }
function attachLiveCounter(el,limit){ el.addEventListener("input",()=>updatePixelCounter(el,limit)); updatePixelCounter(el,limit); }

// Reset
function resetSingle(){ document.getElementById('topic').value=''; document.getElementById('descriptionInput').value=''; document.getElementById('singleResult').innerHTML=''; document.getElementById('singleResult').style.display='none'; }
function resetBatch(){ document.getElementById('topics').value=''; document.getElementById('allResults').innerHTML=''; }

// Maximize pixels without doubling words
function maximizePixels(text, limit, topic=""){
    let result=text.trim(); let px=Math.round(getTextPixelWidth(result));
    const genericFillers=["shop","explore","discover","now","more","today"];
    const topicWords=topic.toLowerCase().split(/\s+/).filter(w=>!result.toLowerCase().includes(w)&&w.length>2);
    const FILLER_WORDS=[...topicWords,...genericFillers];
    if(px>limit){ while(px>limit&&result.length>0){ result=result.replace(/\s+\S+$/,'').trim(); px=Math.round(getTextPixelWidth(result)); } return result; }
    let fillerIdx=0;
    while(px<limit&&fillerIdx<FILLER_WORDS.length){
        const candidate=result+" "+FILLER_WORDS[fillerIdx];
        const candidatePx=Math.round(getTextPixelWidth(candidate));
        if(candidatePx<=limit){ result=candidate; px=candidatePx; }
        fillerIdx++;
    }
    return result;
}

// Toggle snippet
function toggleSnippet(id){ const el=document.getElementById(id); el.style.display=(el.style.display==="none")?"block":"none"; }

// Single generator
async function generate(){
    const topic=document.getElementById("topic").value.trim();
    const titleLimit=parseInt(document.getElementById("singleTitleLimit").value)||580;
    const descLimit=parseInt(document.getElementById("singleDescLimit").value)||990;
    if(!topic)return alert("Enter a topic");
    const container=document.getElementById("singleResult");
    document.getElementById("loadingSingle").style.display="block";
    container.style.display="none";
    try{
        const res=await fetch(API_URL,{method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({topic,maxLength:descLimit})});
        const data=await res.json();
        document.getElementById("loadingSingle").style.display="none";
        container.style.display="block";
        const optimizedTitle=maximizePixels(data.title,titleLimit,topic);
        const optimizedDesc=maximizePixels(data.description,descLimit,topic);
        const snippetId="snippet_single";
        container.innerHTML=`
            <div class="result-container">
                <div class="result-field" id="singleTitle" contenteditable="true">${optimizedTitle}</div>
                <div class="pixel-counter">0px</div>
            </div>
            <button class="copyBtn" onclick="copyText(this,'singleTitle')">Copy Title</button>

            <div class="result-container">
                <div class="result-field" id="singleDescription" contenteditable="true">${optimizedDesc}</div>
                <div class="pixel-counter">0px</div>
            </div>
            <button class="copyBtn" onclick="copyText(this,'singleDescription')">Copy Description</button>

            <div class="result-container">
                <div class="result-field" id="singleKeywords" contenteditable="true">${data.keywords}</div>
            </div>
            <button class="copyBtn" onclick="copyText(this,'singleKeywords')">Copy Keywords</button>

            <button class="generateBtn" onclick="toggleSnippet('${snippetId}')">Preview Snippet</button>
            <div class="snippet" id="${snippetId}">
                <div class="snippet-title">${optimizedTitle}</div>
                <div class="snippet-url">www.example.com/${topic.replace(/\s+/g,'-')}</div>
                <div class="snippet-description">${optimizedDesc}</div>
            </div>
        `;
        attachLiveCounter(document.getElementById("singleTitle"),titleLimit);
        attachLiveCounter(document.getElementById("singleDescription"),descLimit);
    }catch(e){ console.error(e); document.getElementById("loadingSingle").style.display="none"; alert("Error generating SEO data"); }
}

// Batch generator
async function generateAll(){
    const topics=document.getElementById("topics").value.trim().split("\n").filter(t=>t);
    const titleLimit=parseInt(document.getElementById("batchTitleLimit").value)||580;
    const descLimit=parseInt(document.getElementById("batchDescLimit").value)||990;
    if(!topics.length)return alert("Enter topics");
    const resultsDiv=document.getElementById("allResults"); resultsDiv.innerHTML=""; document.getElementById("loadingBatch").style.display="block";
    const allResults=[];
    for(let topic of topics){
        try{
            const res=await fetch(API_URL,{method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({topic,maxLength:descLimit})});
            const data=await res.json();
            const titleId="bt_title_"+Math.random().toString(36).slice(2);
            const descId="bt_desc_"+Math.random().toString(36).slice(2);
            const keyId="bt_key_"+Math.random().toString(36).slice(2);
            const snippetId="snippet_"+Math.random().toString(36).slice(2);
            const optimizedTitle=maximizePixels(data.title,titleLimit,topic);
            const optimizedDesc=maximizePixels(data.description,descLimit,topic);

            const card=document.createElement("div"); card.className="card";
            card.innerHTML=`
                <h4>${topic}</h4>
                <div class="result-container">
                    <div class="result-field" id="${titleId}" contenteditable="true">${optimizedTitle}</div>
                    <div class="pixel-counter">0px</div>
                </div>
                <button class="copyBtn" onclick="copyText(this,'${titleId}')">Copy Title</button>

                <div class="result-container">
                    <div class="result-field" id="${descId}" contenteditable="true">${optimizedDesc}</div>
                    <div class="pixel-counter">0px</div>
                </div>
                <button class="copyBtn" onclick="copyText(this,'${descId}')">Copy Description</button>

                <div class="result-container">
                    <div class="result-field" id="${keyId}" contenteditable="true">${data.keywords}</div>
                </div>
                <button class="copyBtn" onclick="copyText(this,'${keyId}')">Copy Keywords</button>

                <button class="generateBtn" onclick="toggleSnippet('${snippetId}')">Preview Snippet</button>
                <div class="snippet" id="${snippetId}">
                    <div class="snippet-title">${optimizedTitle}</div>
                    <div class="snippet-url">www.example.com/${topic.replace(/\s+/g,'-')}</div>
                    <div class="snippet-description">${optimizedDesc}</div>
                </div>
            `;
            resultsDiv.appendChild(card);
            attachLiveCounter(document.getElementById(titleId),titleLimit);
            attachLiveCounter(document.getElementById(descId),descLimit);
            allResults.push({topic,title:data.title,description:data.description,keywords:data.keywords});
        }catch(e){ console.error(e); }
    }
    window.batchResults=allResults; document.getElementById("loadingBatch").style.display="none";
}

// CSV download
function downloadCSV(){ if(!window.batchResults||!window.batchResults.length)return alert("No batch results"); const headers=["Topic","Title","Description","Keywords"]; const rows=window.batchResults.map(r=>[r.topic,r.title,r.description,r.keywords]); const csv=[headers.join(","),...rows.map(row=>row.map(f=>`"${f.replace(/"/g,'""')}"`).join(","))].join("\n"); const blob=new Blob([csv],{type:"text/csv"}); const url=URL.createObjectURL(blob); const a=document.createElement("a"); a.href=url; a.download="seo_batch.csv"; a.click(); }
</script>
</body>
</html>
